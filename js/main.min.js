!function(n,t,e,i){function o(){var n=this;n.get=function(n,t){t=t===!1?t:!0;var e=localStorage.getItem(n);return t&&e&&(e=JSON.parse(e)),e},n.set=function(n,t){return"object"==typeof t&&(t=JSON.stringify(t)),localStorage.setItem(n,t)}}function r(n){var t=this,e=[],i=function(){e=p.get(n)},o=function(n){(e||[]).forEach(n)},r=function(){p.set(n,e)};t.find=function(n){var t;return o(function(e){e.id===n&&(t=e)}),t},t.findAll=function(){return e},t.add=function(n){e=e||[],e.push(n),r()},t.update=function(n){o(function(t,e){t.id===n.id&&(t=n)}),r()},t.remove=function(n){var t;o(function(e,i){e.id===n&&(t=e)}),t&&(e=e||[],e.splice(t,1)),r()},i()}function a(n,t,e){var i=this;i.$scope=n,i._name=t,i.init=function(){return e.apply(this),this}}function l(n){for(var t=d.generateUniqueID();v.find(t);)t=d.generateUniqueID();this.id=t,this.url=n,this.clicks=0}function c(){var n=h.findAll(),t=!(!n||!n.length);this.isAuthenticated=t,t&&(n=n[0]),this.id=t?n.id:null,this.name=t?n.name:null}function u(){var n=function(){var n=t.location.hash;return n?n.replace("#",""):""},e=n(),i=function(n){if(n){var e=v.find(n);console.log("redireciona para url",e),e&&(e.clicks++,v.update(e),t.location.href=e.url)}};t.onhashchange=function(){e=n(),i(e)},e&&i(e)}var f=[],s={},d={},p=new o,v=new r("url"),h=new r("user"),m=(new u,new c);d.generateUniqueID=function(){return Math.random().toString(36).split("").filter(function(n,t,e){return e.indexOf(n)===t}).join("").substr(2,8)},d.replaceAll=function(n,t,e){return n.replace(new RegExp(t,"g"),e)},l.prototype.toString=function(){var n=t.location;return n.protocol+"//"+n.hostname+n.pathname+"#"+this.id},l.prototype.mapping=function(n){return"object"==typeof n&&(this.id=n.id,this.url=n.url,this.clicks=n.clicks),this},c.prototype.authenticate=function(n){var t=this;t.isAuthenticated=!0,t.id=1,t.name=n,h.add(t)},e(t).on("load",function(){new a(e("#modal"),"modal",function(){var n=this,t=n.$scope,e=t.find(".content");n.open=function(n,i){i=i||function(){},n&&(e.html(n),i(e)),t.removeClass("hidden")},n.close=function(){t.addClass("hidden")};var i=function(){t.find(".close").on("click",function(t){t.preventDefault(),n.close()})};i(),s=this}).init(),f.uploader=new a(e("#app"),"uploader",function(){var i=this.$scope,o=i.find("form"),r=function(r){r.preventDefault(),i.addClass("loading");var a=o.find('input[name="url"]').val();a=new l(a);var c=e(".upload-result");c.find("input").val(a.toString()),c.removeClass("hidden"),v.add(a),c.find(".copyurl").on("click",function(e){e.preventDefault();var i=c.find("input").first();i.select();try{n.execCommand("copy")}catch(o){t.prompt("Use os seguintes comandos para copiar: Ctrl+C, Enter",a.toString()),console.error("Não foi possível copiar o texto")}}),i.removeClass("loading")};o.on("submit",r)}),f.profileHolder=new a(e("#header"),"profileHolder",function(){var n=this.$scope,t=function(){n.html(e("#not-authenticated-template").html()),o()},i=function(){var t=e("#authenticated-template").html();t=t.replace("{{USER}}",m.name),n.html(t),o()},o=function(){var o=function(n){n.preventDefault();var t=function(n){var t=function(n){n.preventDefault();var t=n.target.dataset.urlId;if(!t)return void alert("Erro ao remover");var i=function(){v.remove(t),e(".list-urls-box #"+t).remove(),alert("Removido com sucesso!")},o=confirm("Você deseja realmente excluir este item?");o&&i()};e(".list-urls-box .remove").on("click",t)},i=function(){var n=v.findAll()||[],t={list:[]};return n.forEach(function(n,e){t.list.push((new l).mapping(n))}),t},o=function(){var n=e("#list-urls-template").html(),t=e("#url-item-template").html(),o="",r=i();return r.list.forEach(function(n,e){var i=t;i=d.replaceAll(i,"{{ID}}",n.id),i=d.replaceAll(i,"{{SHORT}}",n.toString()),i=d.replaceAll(i,"{{ORIGINAL}}",n.url),i=d.replaceAll(i,"{{CLICKS}}",n.clicks),o+=i}),n=d.replaceAll(n,"{{LIST}}",o)};s.open(o(),t)},r=function(n){n.preventDefault(),h.remove(m.id),t()},a=function(n){n.preventDefault();var t=e("#login-template").html(),o=function(n){var t={user:"user",pass:"pass"},o=function(n){m.authenticate(n),s.close(),i()};n.find("form").on("submit",function(n){n.preventDefault();var i=function(){alert("Falha ao logar.")},r=e(n.target),a=r.find(".user").val(),l=r.find(".pass").val();l&&a&&a==t.user&&l==t.pass?o(a):i()})};s.open(t,o)};n.find(".login-action").on("click",a),n.find(".logout-action").on("click",r),n.find(".list-urls-action").on("click",o)};m.isAuthenticated?i():t()});var i=function(){f.uploader.init(),f.profileHolder.init()};i()})}(document,window,$);